(function(v){function w(b,e,f){b.on("click",function(h,q){h=jQuery(this);h.hasClass("oo-choosed")||h.hasClass("oo-selected")||h.addClass("oo-selected")}).draggable({containment:"#"+e,scroll:!1,revert:"invalid",stop:function(h,q){jQuery(this).css({left:"0px",top:"0px"});jQuery(q.helper).removeClass("oo-drag")},helper:function(){var h=jQuery(this);if(!(0<h.parent(".association_box").length)&&t(this,e))return h.removeClass("oo-selected"),h=h.clone(),jQuery(h).attr("id","n"+k()).data("qti-cloned","true").addClass("oo-drag"),
h;h.addClass("oo-drag");return h}}).on("click",{formId:f.formDispatchFieldId},setFlexiFormDirtyByListener)}function t(b,e){var f=jQuery(b);b=f.data("qti-match-max");f=f.data("qti-id");e=jQuery("#"+e+"_panel div[data-qti-id\x3d'"+f+"']").length;return 0==b||e+1<b}function m(b,e,f){b.on("click",function(h,q){var r=jQuery(this);1==jQuery(".o_associate_item",this).length?jQuery(".o_associate_item",this).each(function(n,x){l(x,r,e)}):jQuery("#"+e+"_items .o_associate_item.oo-selected").each(function(n,
x){n=jQuery(x);t(x,e)?(n.removeClass("oo-selected"),g(n.clone(),r,e)):g(n,r,e)});d(e,f);setFlexiFormDirty(f.formDispatchFieldId,!1)}).droppable({drop:function(h,q){var r=jQuery(this);0<jQuery(".o_associate_item",this).length&&jQuery(".o_associate_item",this).each(function(n,x){l(x,r,e)});null!=q.helper&&"true"==jQuery(q.helper).data("qti-cloned")?(h=jQuery(q.draggable),h.removeClass("oo-selected").removeClass("oo-drag"),h=h.clone(),w(h,e,f)):(h=jQuery(q.draggable),h.removeClass("oo-selected").removeClass("oo-drag"));
g(h,r,e);d(e,f);setFlexiFormDirty(f.formDispatchFieldId,!1)}}).on("click",{formId:f.formDispatchFieldId},setFlexiFormDirtyByListener)}function g(b,e,f){b.removeClass("oo-selected").css({left:"0px",top:"0px"}).addClass("oo-choosed").appendTo(e);e.addClass("oo-filled")}function l(b,e,f){e.removeClass("oo-filled");b=jQuery(b);b.removeClass("oo-choosed");e=b.data("qti-id");0==jQuery("#"+f+"_items div[data-qti-id\x3d'"+e+"']").length?b.appendTo(jQuery("#"+f+"_items")):b.remove()}function k(){function b(){return Math.floor(65536*
(1+Math.random())).toString(16).substring(1)}return b()+b()+b()+b()+b()+b()+b()}function d(b,e){var f=jQuery("#"+b+"_panel");f.find("input[type\x3d'hidden']").remove();jQuery("#"+b+"_panel .association").each(function(h,q){h=jQuery(q).find(".o_associate_item");2==h.length?(q=jQuery(h.get(0)).data("qti-id"),h=jQuery(h.get(1)).data("qti-id"),q=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+e.responseIdentifier).attr("value",q+" "+h),f.prepend(q)):0==h.length&&e.unrestricted?
q.remove():jQuery(q).find(".association_box").each(function(r,n){0==jQuery(n).find(".o_associate_item").length&&jQuery(n).hasClass("oo-filled")&&jQuery(n).removeClass("oo-filled")})});a(b,e)}function a(b,e){if(e.unrestricted&&e.opened){jQuery("#"+b+"_panel");var f=!0;jQuery("#"+b+"_panel .association").each(function(q,r){2!=jQuery(r).find(".o_associate_item").length&&(f=!1)});if(f){var h=c(b,e);h=jQuery("#"+h+" .association_box");m(h,b,e)}}}function c(b,e){e=k();var f='\x3cdiv id\x3d"'+e+'" class\x3d"association" style\x3d""\x3e\n  \x3cdiv class\x3d"association_box left" style\x3d"width: 100px; height:50px; float:left;"\x3e\x3c/div\x3e\n  \x3cdiv class\x3d"association_box right" style\x3d"width: 100px; height:50px; float:right;"\x3e\x3c/div\x3e\n  \x3cdiv style\x3d"clear:both; "\x3e\x3c/div\x3e\n\x3c/div\x3e\n';
jQuery("#"+b+"_panel").append(f);jQuery("#"+b+"_panel").append('\x3cdiv style\x3d"clear:both; "\x3e\x3c/div\x3e\n');return e}v.fn.associateInteraction=function(b){b=v.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,opened:!1,unrestricted:!1},b);try{if("undefined"!=typeof b.responseValue&&0<b.responseValue.length){for(var e=this.attr("id"),f=b.responseValue.split(","),h=jQuery("#"+e+"_panel .association"),q=0;q<f.length;q++){var r=f[q].split(" "),n=jQuery(h.get(q));if(0==
n.length){var x=c(e,b);n=jQuery("#"+x)}var y=jQuery("#"+e+"_items div[data-qti-id\x3d'"+r[0]+"']");t(y,e)&&(y=jQuery(y).clone());var z=jQuery("#"+e+"_items div[data-qti-id\x3d'"+r[1]+"']");t(z,e)&&(z=jQuery(z).clone());jQuery(y).addClass("oo-choosed");jQuery(z).addClass("oo-choosed");jQuery(n.find(".association_box.left")).addClass("oo-filled").append(y);jQuery(n.find(".association_box.right")).addClass("oo-filled").append(z)}d(e,b);b.unrestricted&&b.opened&&a(e,b)}if(b.opened){var C=this.attr("id"),
B=jQuery("#"+C+" .o_associate_item");w(B,C,b);var p=jQuery("#"+C+"_panel .association_box");m(p,C,b)}}catch(u){window.console&&console.log(u)}return this}})(jQuery);
(function(v){function w(m,g){jQuery("#qti_container_"+g.responseIdentifier+" input[type\x3dcheckbox]").on("click",function(l,k){t(g)})}function t(m){var g=jQuery("#qti_container_"+m.responseIdentifier+" input[type\x3dcheckbox]"),l=0;g.each(function(k,d){d.checked&&l++});l>=m.maxChoices?g.each(function(k,d){d.disabled=d.checked?!1:!0}):g.each(function(k,d){d.disabled=!1})}v.fn.choiceInteraction=function(m){m=v.extend({responseIdentifier:null,formDispatchFieldId:null,maxChoices:0},m);try{0<m.maxChoices&&
(w(this,m),t(m))}catch(g){window.console&&console.log(g)}return this}})(jQuery);
(function(v){function w(d,a,c){var b=a.value,e=b.split(" ");c(d,a,b,d.gapChoiceMap[e[0]],d.gapMap[e[1]])}function t(d,a){if(a.opened)m(a.responseIdentifier).on("click",function(){k(a,this);setFlexiFormDirty(a.formDispatchFieldId)});g(a);l(a)}function m(d){return jQuery("input[name\x3dqtiworks_response_"+d+"]")}function g(d){d.matchCount=0;for(var a in d.gapChoiceMap)d.gapChoiceMap[a].matchCount=0;for(a in d.gapMap)d.gapMap[a].matched=!1,d.gapMap[a].matchedGapChoice=null;m(d.responseIdentifier).each(function(b,
e){w(d,this,function(f,h,q,r,n){h.checked&&(r.matchCount++,n.matched=!0,n.matchedGapChoice=r,f.matched[q]=!0)})});for(a in d.gapMap){var c=d.gapMap[a];c.query.text(c.matched?c.matchedGapChoice.text:c.label)}}function l(d){m(d.responseIdentifier).each(function(){w(d,this,function(a,c,b,e,f){c.disabled=a.opened?c.checked?!1:f.matched||0!=e.matchMax&&e.matchCount>=e.matchMax?!0:!1:!0})})}function k(d,a){w(d,a,function(c,b,e,f,h){b.checked?(h.matched||0!=f.matchMax&&f.matchMax<=f.matchCount?b.checked=
!1:(f.matchCount++,h.matched=!0,h.matchedGapChoice=f),h.query.text(f.text)):(f.matchCount--,h.matched=!1,h.matchedGapChoice=null,h.query.text(h.label));l(c)})}v.fn.gapMatchInteraction=function(d){d=v.extend({responseIdentifier:null,formDispatchFieldId:null,gapChoiceData:{},gapData:{},opened:!1,gapChoiceMap:{},gapMap:{},matched:{}},d);for(var a in d.gapChoiceData){var c=jQuery("#qtiworks_id_"+d.responseIdentifier+"_"+a);d.gapChoiceMap[a]={matchMax:d.gapChoiceData[a],matchCount:0,query:c,text:c.text()}}for(a in d.gapData)c=
jQuery("#qtiworks_id_"+d.responseIdentifier+"_"+a),d.gapMap[a]={required:d.gapData[a],matched:!1,matchedGapChoice:null,query:c,label:c.text()};try{t(this,d)}catch(b){window.console&&console.log(b)}return this}})(jQuery);
(function(v){function w(g,l,k){var d=g.attr("id");jQuery("#"+d+"_container area").on("click",function(a){a=jQuery("#"+d+"_container").data("openolat")||{};void 0==a.listOfPairs&&(a.currentSpot="",a.listOfPairs=[],jQuery("#"+d+"_container").data("openolat",a));var c=jQuery(this).data("qti-id");""==a.currentSpot||a.currentSpot==c?a.currentSpot=c:(a.listOfPairs.push([a.currentSpot,c]),a.currentSpot="");var b=document.getElementById(d+"_canvas");c=b.getContext("2d");c.clearRect(0,0,jQuery(b).width(),
jQuery(b).height());b=jQuery("#"+d+"_container");b.find("input[type\x3d'hidden']").remove();var e=[];""!=a.currentSpot&&(t(c,"ac_"+k+"_"+a.currentSpot),e.push(a.currentSpot));for(var f=a.listOfPairs.length;0<f--;){for(var h=a.listOfPairs[f],q=h.length;0<q--;)0>e.indexOf(h[q])&&(t(c,"ac_"+k+"_"+h[q]),e.push(h[q]));q=jQuery("#ac_"+k+"_"+h[1]);h=jQuery("#ac_"+k+"_"+h[0]);var r=m(q),n=m(h);c.beginPath();c.moveTo(r[0],r[1]);c.lineTo(n[0],n[1]);c.lineWidth=3;c.stroke();q=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name",
"qtiworks_response_"+k).attr("value",h.data("qti-id")+" "+q.data("qti-id"));b.prepend(q)}})}function t(g,l){jQuery("#"+l).each(function(k,d){d=jQuery(d);k=m(d);d=d.attr("shape");var a;var c=a=0;g.beginPath();if("rect"==d)g.rect(k[0]+a,k[1]+c,k[2]-k[0],k[3]-k[1]);else if("poly"==d)for(g.moveTo(k[0]+a,k[1]+c),i=2;i<k.length;i+=2)g.lineTo(k[i]+a,k[i+1]+c);else"circ"!=d&&"circle"!=d||g.arc(k[0]+a,k[1]+c,k[2]-2,0,2*Math.PI,!1);g.closePath();g.lineWidth=4;g.strokeStyle="#003300";g.stroke();g.fillStyle=
"green";g.fill()})}function m(g){g=g.attr("coords").split(",");for(i=g.length;0<i--;)g[i]=parseFloat(g[i]);return g}v.fn.graphicAssociateInteraction=function(g){g=v.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,maxAssociations:1,opened:!1},g);try{if("undefined"!==typeof g.responseValue&&0<g.responseValue.length){var l=g.responseValue,k=g.responseIdentifier,d=this.attr("id"),a=jQuery("#"+d+"_container"),c=document.getElementById(d+"_canvas"),b=c.getContext("2d");b.clearRect(0,
0,jQuery(c).width(),jQuery(c).height());d=[];for(var e=l.split(","),f=e.length;0<f--;){for(var h=e[f].split(" "),q=h.length;0<q--;)0>d.indexOf(h[q])&&(t(b,"ac_"+k+"_"+h[q]),d.push(h[q]));if(2==h.length){var r=jQuery("#ac_"+k+"_"+h[1]),n=jQuery("#ac_"+k+"_"+h[0]),x=m(r),y=m(n);b.beginPath();b.moveTo(x[0],x[1]);b.lineTo(y[0],y[1]);b.lineWidth=3;b.stroke();var z=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+k).attr("value",n.data("qti-id")+" "+r.data("qti-id"));a.prepend(z)}}}g.opened&&
w(this,g.maxAssociations,g.responseIdentifier)}catch(C){window.console&&console.log(C)}return this}})(jQuery);
(function(v){function w(g,l){var k=g.attr("id");jQuery(".gap_item").on("click",function(d,a){d=jQuery(this);if(d.hasClass("oo-choosed"))if(a=d.data("drop-timestamp"),"undefined"!==typeof a&&null!=a&&1500>Date.now()-a)d.data("drop-timestamp",null);else{d.removeClass("oo-choosed");var c=d.data("qti-id");jQuery("#"+k).find("input[type\x3d'hidden']").each(function(b,e){0==jQuery(e).val().indexOf(c+" ")&&jQuery(e).remove()});d.css({position:"relative",left:"0px",top:"0px"})}else d.addClass("oo-selected")}).draggable({containment:"#"+
k,scroll:!1,revert:"invalid",stop:function(d,a){jQuery(this).hasClass("oo-choosed")||jQuery(this).css({position:"relative",left:"0px",top:"0px"})}}).mousemove(function(d,a){a=jQuery(this);if(a.hasClass("ui-draggable-dragging")){var c=jQuery("#"+k+"_img").offset(),b=a.offset();d=b.left+a.width()/2-c.left;a=b.top+a.height()/2-c.top;var e=t(d,a,k);"invalid"!=e?(jQuery("#"+k+" area").each(function(f,h){f=jQuery(h);h=f.attr("id");e==h?f.mouseover():f.mouseout()}),jQuery("#"+e).mouseover()):jQuery("#"+
k+" area").each(function(f,h){jQuery(h).mouseout()})}});jQuery("#"+k).droppable({drop:function(d,a){d=jQuery("#"+k+"_img").offset();a=jQuery(a.draggable);var c=a.offset(),b=c.left+a.width()/2-d.left;d=c.top+a.height()/2-d.top;d=t(b,d,k);if("invalid"!=d){d=jQuery("#"+d);b=m(d);c=d.data("qti-id");var e=a.data("qti-id");a.css("position","absolute");a.css("left",b[0]+"px");a.css("top",b[1]+"px");a.css("border","none");a.removeClass("oo-selected");a.addClass("oo-choosed");b=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name",
"qtiworks_response_"+l.responseIdentifier).attr("value",e+" "+c);jQuery(this).prepend(b);jQuery(d).mouseout();a.data("drop-timestamp",Date.now())}}});jQuery("#"+k+" area").on("click",function(d,a){var c=jQuery(this);jQuery(".gap_item.oo-selected").each(function(b,e){var f=jQuery(e),h=m(c);b=c.data("qti-id");e=f.data("qti-id");f.css("position","absolute");f.css("left",h[0]+"px");f.css("top",h[1]+"px");f.css("border","none");f.removeClass("oo-selected");f.addClass("oo-choosed");f=jQuery("#"+k);b=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name",
"qtiworks_response_"+l.responseIdentifier).attr("value",e+" "+b);f.prepend(b)})})}function t(g,l,k){var d="invalid";jQuery("#"+k+" area").each(function(a,c){c=jQuery(c);a=c.attr("id");c.attr("coords");var b=c.attr("shape");c=m(c);if("circle"==b)Math.pow(c[2],2)>=Math.pow(g-c[0],2)+Math.pow(l-c[1],2)&&(d=a);else if("rect"==b)c=c[0]<=g&&g<=c[2]&&c[1]<=l&&l<=c[3]?!0:!1,c&&(d=a);else if("poly"==b){a={x:[],y:[]};b=c.length/2;var e=0;for(ix=0;ix<b;ix++)a.x[ix]=c[e],a.y[ix]=c[e+1],e+=2;for(i=0;i<a.length;i++){e=
a.x.length;var f=a.x,h=a.y,q=!1;b=0;for(c=e-1;b<e;c=b++)h[b]>l!=h[c]>l&&g<(f[c]-f[b])*(l-h[b])/(h[c]-h[b])+f[b]&&(q=!q);if(q){d=a.id;break}}}});return d}function m(g){g=g.attr("coords").split(",");for(i=g.length;0<i--;)g[i]=parseFloat(g[i]);return g}v.fn.graphicGapInteraction=function(g){g=v.extend({maphilight:null,responseIdentifier:null,formDispatchFieldId:null,responseValue:null,opened:!1},g);try{if("undefined"!==typeof g.responseValue&&0<g.responseValue.length)for(var l=this.attr("id"),k=jQuery("#"+
l),d=g.responseValue.split(","),a=d.length;0<a--;){var c=d[a].split(" "),b=jQuery("#ac_"+g.responseIdentifier+"_"+c[0]),e=jQuery("#ac_"+g.responseIdentifier+"_"+c[1]);if(b.hasClass("gap_item")){var f=b;var h=e}else f=e,h=b;var q=m(h);f.css("position","absolute");f.css("left",q[0]+"px");f.css("top",q[1]+"px");f.addClass("oo-choosed");var r=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+g.responseIdentifier).attr("value",f.data("qti-id")+" "+h.data("qti-id"));k.prepend(r)}g.opened&&
w(this,g)}catch(n){window.console&&console.log(n)}return this}})(jQuery);
(function(v){function w(t,m){var g=t.attr("id");jQuery("#"+g+"_container area").on("click",function(l){var k=jQuery(this).attr("id"),d=jQuery(this).data("qti-id");l=jQuery(this).attr("coords").split(",");var a=l[0],c=l[1];l=jQuery("#"+g+"_container").data("openolat")||{};void 0==l.listOfPoints&&(l.listOfPoints=[],jQuery("#"+g+"_container").data("openolat",l));for(var b=!1,e=[],f=l.listOfPoints.length;0<f--;){var h=l.listOfPoints[f];64>(h.x-a)*(h.x-a)+(h.y-c)*(h.y-c)?b=!0:e.push(h)}if(b)l.listOfPoints=
e;else{if(l.listOfPoints.length>=m.maxChoices)return!1;l.listOfPoints.push({x:a,y:c,areaId:k,spotQtiId:d})}f=document.getElementById(g+"_canvas");k=f.getContext("2d");k.clearRect(0,0,jQuery(f).width(),jQuery(f).height());d=jQuery("#"+g+"_container");d.find("input[type\x3d'hidden']").remove();for(f=l.listOfPoints.length;0<f--;)h=l.listOfPoints[f],k.font="16px Arial",k.fillText(""+(f+1),h.x,h.y),h=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+m.responseIdentifier).attr("value",
h.spotQtiId),d.prepend(h)})}v.fn.graphicOrderInteraction=function(t){t=v.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,maxChoices:1,opened:!1},t);try{if("undefined"!==typeof t.responseValue&&0<t.responseValue.length){var m=this.attr("id"),g=jQuery("#"+m+"_container"),l=document.getElementById(m+"_canvas"),k=l.getContext("2d");k.clearRect(0,0,jQuery(l).width(),jQuery(l).height());for(var d=t.responseValue.split(","),a=d.length;0<a--;)if(0!=d[a].length){var c=jQuery("#ac_"+
t.responseIdentifier+"_"+d[a]),b=c.data("qti-id"),e=c.attr("coords").split(","),f=e[0],h=e[1];k.font="16px Arial";k.fillText(""+(a+1),f,h);var q=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+t.responseIdentifier).attr("value",b);g.prepend(q)}}t.opened&&w(this,t)}catch(r){window.console&&console.log(r)}return this}})(jQuery);
(function(v){function w(g,l){var k=g.attr("id");jQuery("#"+k+" map area").each(function(d,a){jQuery(a).on("click",function(){t(this,k,l.responseIdentifier,l.maxChoices,l.singleChoice,l.maphilightSettings)})})}function t(g,l,k,d,a,c){g=jQuery(g);var b=g.data("maphilight")||{};if("undefined"===typeof b.selectedOn||!b.selectedOn)if(a&&jQuery("area","map[name\x3d'"+l+"_map']").each(function(h,q){h=jQuery(q).data("maphilight")||{};h.selectedOn&&(h.selectedOn=!1,m(h,c),jQuery(q).data("maphilight",h).trigger("alwaysOn.maphilight"))}),
0<d){var e=0;jQuery("area","map[name\x3d'"+l+"_map']").each(function(h,q){(jQuery(q).data("maphilight")||{}).selectedOn&&e++});if(e>=d)return!1}b.selectedOn="undefined"===typeof b.selectedOn?!0:!b.selectedOn;m(b,c);g.data("maphilight",b).trigger("alwaysOn.maphilight");var f=jQuery("#"+l);f.find("input[type\x3d'hidden']").remove();jQuery("area","map[name\x3d'"+l+"_map']").each(function(h,q){h=jQuery(q);(h.data("maphilight")||{}).selectedOn&&(h=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name",
"qtiworks_response_"+k).attr("value",h.data("qti-id")),f.append(h))})}function m(g,l){g.selectedOn?(g.fillColor=l.selectedFillColor,g.fillOpacity=l.selectedFillOpacity,g.strokeColor=l.selectedStrokeColor,g.strokeOpacity=l.selectedStrokeOpacity,g.shadow=l.selectedShadow,g.shadowX=0,g.shadowY=0,g.shadowRadius=7,g.shadowColor="000000",g.shadowOpacity=.8,g.shadowPosition="outside"):(g.fillColor=l.fillColor,g.fillOpacity=l.fillOpacity,g.strokeColor=l.strokeColor,g.strokeOpacity=l.strokeOpacity,g.shadow=
!1)}v.fn.hotspotInteraction=function(g){g=v.extend({responseIdentifier:null,formDispatchFieldId:null,maxChoices:1,singleChoice:!1,responseValue:null,opened:!1,maphilightSettings:{}},g);try{if("undefined"!==typeof g.responseValue&&0<g.responseValue.length)for(var l=this.attr("id"),k=jQuery("#"+l),d=g.responseValue.split(","),a=d.length;0<a--;){var c=jQuery("#ac_"+g.responseIdentifier+"_"+d[a]),b=c.data("maphilight")||{};b.selectedOn=!0;m(b,g.maphilightSettings);c.data("maphilight",b).trigger("alwaysOn.maphilight");
var e=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+g.responseIdentifier).attr("value",c.data("qti-id"));k.append(e)}g.opened&&w(this,g)}catch(f){window.console&&console.log(f)}return this}})(jQuery);
(function(v){v.fn.rwdImageMaps=function(w){var t=v.extend({fillColor:"bbbbbb",fillOpacity:.5,strokeColor:"6E6E6E",strokeOpacity:1},w),m=this,g=null,l=0,k=0;w=function(){m.each(function(){if("undefined"!=typeof v(this).attr("usemap")){var d=function(b,e){v("\x3cimg /\x3e").on("load",function(){e.data("width")||e.data("width",e.attr("width"));e.data("height")||e.data("height",e.attr("height"));var f=e.data("width"),h=e.data("height");if(!f||!h){var q=new Image;q.src=e.attr("src");f||(f=q.width,e.data("width",
h));h||(h=q.height,e.data("height",h))}q=e.closest(".o_oo_hotcontainer").width();var r=e.width(),n=e.height();q<f?(r=q,n=h/f*q|0,e.width(r),e.height(n)):0==r&&0==n&&(r=f,n=h,e.width(r),e.height(n));var x=r/100,y=n/100;q=e.attr("usemap").replace("#","");v('map[name\x3d"'+q+'"]').find("area").each(function(){var z=v(this);z.data("coords")||z.data("coords",z.attr("coords"));for(var C=z.data("coords").split(","),B=Array(C.length),p=0;p<B.length;++p)B[p]=0===p%2?parseInt(C[p]/f*100*x):parseInt(C[p]/h*
100*y);z.attr("coords",B.toString())});g=!0;e.maphilight({fillColor:t.fillColor,fillOpacity:t.fillOpacity,strokeColor:t.strokeColor,strokeOpacity:t.strokeOpacity,strokeWidth:3,alwaysOn:!0})}).attr("src",e.attr("src"))},a=v(this),c=a.closest(".o_oo_hotcontainer").width();if(g){if(l!=window.innerWidth||k!=c)d(this,a),l=window.innerWidth,k=c}else l=window.innerWidth,k=c,d(this,a)}})};v(window).resize(w).trigger("resize");v(m).closest(".o_qti21_collapsable_solution").on("shown.bs.collapse",w);return this}})(jQuery);
(function(v){function w(a,c){t(c.responseIdentifier).on("click",function(){k(c,this)});g(c);l(c)}function t(a){return jQuery("input[name\x3dqtiworks_response_"+a+"]")}function m(a,c,b){var e=c.value,f=e.split(" ");b(c,e,a.leftMap[f[0]],a.rightMap[f[1]])}function g(a){a.matchCount=0;a.matched={};for(var c in a.leftMap)a.leftMap[c].matchCount=0;for(c in a.rightMap)a.rightMap[c].matchCount=0;t(a.responseIdentifier).each(function(){m(a,this,function(b,e,f,h){b.checked&&(a.matchCount++,f.matchCount++,
h.matchCount++,a.matched[e]=!0)})})}function l(a){t(a.responseIdentifier).each(function(){m(a,this,function(c,b,e,f){c.disabled=c.checked?!1:0!=a.maxAssociations&&a.matchCount>=a.maxAssociations?!0:0!=e.matchMax&&e.matchCount>=e.matchMax?1!=e.matchMax&&1!=e.matchCount?!0:!1:0!=f.matchMax&&f.matchCount>=f.matchMax?!0:!1})})}function k(a,c){m(a,c,function(b,e,f,h){if(b.checked){e=!1;if(1==f.matchMax){e=jQuery(b);var q=e.attr("id"),r=e.attr("value").split(" ")[0];t(a.responseIdentifier).each(function(){m(a,
this,function(n,x,y,z){x=jQuery(n);q!==x.attr("id")&&n.checked&&(x=x.attr("value").split(" ")[0],r===x&&(n.checked=!1,y.matchCount--,z.matchCount--,a.matchCount--))})});f.matchCount++;a.matchCount++;e=!0}else 0!=f.matchMax&&f.matchMax<=f.matchCount?b.checked=!1:(f.matchCount++,a.matchCount++,e=!0);0!=h.matchMax&&h.matchMax<=h.matchCount?b.checked=!1:(h.matchCount++,e||a.matchCount++)}else a.matchCount--,f.matchCount--,h.matchCount--;l(a);b.checked||null==a.unansweredColumn||d(a,b)})}function d(a,
c){var b=jQuery(c).attr("value").split(" ")[0],e=0,f=null;t(a.responseIdentifier).each(function(){m(a,this,function(h,q,r,n){q=jQuery(h);r=q.attr("value").split(" ")[0];b===r&&(h.checked?e++:1==q.closest("."+a.unansweredColumn).length&&(f=h))})});0==e&&null!=f&&(f.checked=!0)}v.fn.matchInteraction=function(a){a=v.extend({responseIdentifier:null,formDispatchFieldId:null,maxAssociations:1,unansweredColumn:null,leftData:{},rightData:{},leftMap:{},rightMap:{},matched:[]},a);for(var c in a.leftData)a.leftMap[c]=
{matchMax:a.leftData[c],matchCount:0};for(c in a.rightData)a.rightMap[c]={matchMax:a.rightData[c],matchCount:0};try{w(this,a)}catch(b){window.console&&console.log(b)}return this}})(jQuery);
(function(v){function w(c,b){jQuery("#"+c+" .o_match_dnd_sources").droppable({tolerance:"pointer",over:function(e,f){jQuery(this).addClass("oo-accepted")},out:function(e,f){jQuery(this).removeClass("oo-accepted")},drop:function(e,f){e=jQuery(this);e.removeClass("oo-accepted");f=jQuery(f.draggable);var h=f.data("qti-id");0<e.find("li[data-qti-id\x3d'"+h+"']").length?0==f.parents(".o_match_dnd_sources").length&&f.remove():f.appendTo(e);a(c,b);setFlexiFormDirty(b.formDispatchFieldId,!1)}}).on("click",
{formId:b.formDispatchFieldId},setFlexiFormDirtyByListener)}function t(c,b,e){c.on("click",function(f,h){f=jQuery(this);f.hasClass("oo-choosed")||f.hasClass("oo-selected")?0<f.parents(".o_match_dnd_targets").length&&!f.hasClass("oo-dropped-mrk")&&(d(f,b),a(b,e),setFlexiFormDirty(e.formDispatchFieldId,!1)):(jQuery("#"+b+" .o_match_dnd_sources .o_match_dnd_source").each(function(q,r){jQuery(r).removeClass("oo-selected")}),f.addClass("oo-selected"))}).draggable({containment:"#"+b,scroll:!1,revert:"invalid",
cursorAt:{left:5,top:5},start:function(f,h){jQuery(h.helper).removeClass("oo-dropped-mrk")},stop:function(f,h){jQuery(this).css({left:"0px",top:"0px","z-index":""});jQuery(h.helper).removeClass("oo-drag")},helper:function(){var f=jQuery(this);if(!(0<f.parent(".o_match_dnd_target").length)&&g(this,b)){f.removeClass("oo-selected");var h=f.clone();jQuery(h).attr("id","n"+m()).data("qti-cloned","true").addClass("oo-drag").addClass("oo-drag-mrk").css("z-index",10).css("width",f.width()).css("height",f.height());
return h}f.addClass("oo-drag").addClass("oo-drag-mrk").css("z-index",10);return f}}).on("click",{formId:e.formDispatchFieldId},setFlexiFormDirtyByListener)}function m(){function c(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return c()+c()+c()+c()+c()+c()+c()}function g(c,b){var e=jQuery(c);if(0<e.parents(".o_match_dnd_target").length)return!1;c=e.data("qti-match-max");e=e.data("qti-id");b=jQuery("#"+b+" .o_match_dnd_targets li[data-qti-id\x3d'"+e+"']").length;return 0==
c||b+1<c}function l(c,b,e){c.on("click",function(f,h){var q=this,r=jQuery(q);0==jQuery(".o_associate_item",this).length&&jQuery("#"+b+" .o_match_dnd_sources .oo-selected").each(function(n,x){n=jQuery(x);var y=n.data("qti-id");y=0==jQuery(".o_match_dnd_source[data-qti-id\x3d'"+y+"']",q).length;var z=jQuery(q).data("qti-match-max");0<z&&jQuery(".o_match_dnd_source",q).length>=z&&(y&=0);y&&(g(x,b)?(n.removeClass("oo-selected"),n=n.clone(),k(n,r,b),t(n,b,e)):k(n,r,b))});a(b,e);setFlexiFormDirty(e.formDispatchFieldId,
!1)}).droppable({tolerance:"pointer",accept:function(f){f=jQuery(f).data("qti-id");if(f=0==jQuery(".o_match_dnd_source[data-qti-id\x3d'"+f+"']",this).length){var h=jQuery(this).data("qti-match-max");0<h&&jQuery(".o_match_dnd_source",this).length>=h&&(f=!1)}return f},over:function(f,h){jQuery(this).addClass("oo-accepted")},out:function(f,h){jQuery(this).removeClass("oo-accepted")},drop:function(f,h){f=jQuery(this);f.removeClass("oo-accepted");var q=jQuery(h.draggable),r=q.data("qti-id");0<jQuery(".o_match_dnd_source[data-qti-id\x3d'"+
r+"']",this).length||(null!=h.helper&&"true"==jQuery(h.helper).data("qti-cloned")?(q.removeClass("oo-selected").removeClass("oo-drag"),q=q.clone(),t(q,b,e)):q.removeClass("oo-selected").removeClass("oo-drag"),k(q,f,b),q.addClass("oo-dropped-mrk"),setTimeout(function(){q.removeClass("oo-dropped-mrk")},100),a(b,e),setFlexiFormDirty(e.formDispatchFieldId,!1))}}).on("click",{formId:e.formDispatchFieldId},setFlexiFormDirtyByListener)}function k(c,b,e){e=b.find("ul.o_match_dnd_target_drop_zone");c.removeClass("oo-selected").css({width:"auto",
left:"0px",top:"0px","z-index":""}).addClass("oo-choosed").appendTo(e);b.addClass("oo-filled")}function d(c,b){c=jQuery(c);c.removeClass("oo-choosed");var e=c.data("qti-id");0==jQuery("#"+b+" .o_match_dnd_sources li[data-qti-id\x3d'"+e+"']").length?c.css({width:"auto",left:"0px",top:"0px","z-index":""}).appendTo(jQuery("#"+b+" .o_match_dnd_sources")):c.remove()}function a(c,b){b.matchCount=0;b.matched={};for(var e in b.leftMap)b.leftMap[e].matchCount=0;for(e in b.rightMap)b.rightMap[e].matchCount=
0;var f=jQuery("#"+c);f.find("input[type\x3d'hidden']").remove();jQuery("#"+c+" .o_match_dnd_target_drop_zone").each(function(h,q){jQuery(q).find(".o_match_dnd_source").each(function(r,n){r=jQuery(n).data("qti-id");n=jQuery(q).data("qti-id");r=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+b.responseIdentifier).attr("value",r+" "+n);f.prepend(r)})})}v.fn.matchInteractionDnd=function(c){c=v.extend({responseIdentifier:null,formDispatchFieldId:null,maxAssociations:1,responseValue:null,
opened:!1},c);try{if("undefined"!=typeof c.responseValue&&0<c.responseValue.length){for(var b=this.attr("id"),e=c.responseValue.split(","),f=0;f<e.length;f++){var h=e[f].split(" "),q=h[1],r=jQuery("#"+b+" .o_match_dnd_sources li[data-qti-id\x3d'"+h[0]+"']");g(r,b)&&(r=jQuery(r).clone());var n=jQuery("#"+b+" .o_match_dnd_targets ul[data-qti-id\x3d'"+q+"']");jQuery(r).addClass("oo-choosed");jQuery(n).addClass("oo-choosed");jQuery(n).addClass("oo-filled").append(r);var x=r.attr("data-qti-scores");if(null!=
x&&0<x.length)for(var y=x.split(";"),z=0;z<y.length;z++){var C=y[z];if(0==C.indexOf(q)){var B=C.split("\x3d")[1];r.append("\x3cdiv style\x3d'text-align: right;' class\x3d'o_qti_score_infos'\x3e"+B+"\x3c/div\x3e")}}}a(b,c);c.unrestricted&&c.opened&&addNewAssociationBoxAndEvents(b,c)}if(c.opened){var p=this.attr("id");w(p,c);var u=jQuery("#"+p+" .o_match_dnd_source");t(u,p,c);var A=jQuery("#"+p+" .o_match_dnd_target");l(A,p,c)}}catch(D){window.console&&console.log(D)}return this}})(jQuery);
(function(v){function w(m,g){m="#qtiworks_response_"+g.responseIdentifier;jQuery(m+" div.source \x3e ul");jQuery(m+" div.target \x3e ul");var l=jQuery(m+" div.source \x3e ul").get(0),k=jQuery(m+" div.target \x3e ul").get(0);dragula([l,k],{copy:function(d,a){return!1},accepts:function(d,a){return a!==l}}).on("drag",function(d,a){}).on("over",function(d,a,c){a===k&&jQuery(a).addClass("oo-accepted")}).on("drop",function(d,a,c,b){t(g);setFlexiFormDirty(g.formDispatchFieldId)}).on("dragend",function(d){jQuery(k).removeClass("oo-accepted")}).on("out",
function(d){jQuery(k).removeClass("oo-accepted")})}function t(m){var g="#qtiworks_response_"+m.responseIdentifier;jQuery(g+" div.source \x3e ul");var l=jQuery(g+" div.target \x3e ul"),k=jQuery(g+" div.target"),d=jQuery(g+" div.hiddenInputContainer"),a=l.children("li").length;if(null!=m.minChoices&&null!=m.maxChoices){if(a<m.minChoices||a>m.maxChoices)return m.minChoices!=m.maxChoices?alert("You must select and order between "+m.minChoices+" and "+m.maxChoices+" items"):alert("You must select and order exactly "+
m.minChoices+" item"+(1<minChoices?"s":"")),k.toggleClass("highlight",!0),!1;k.toggleClass("highlight",!1)}d=jQuery(g+" div.hiddenInputContainer");d.empty();l.children("li").each(function(c){c=this.id.substring(18);var b=jQuery('\x3cinput type\x3d"hidden"\x3e');b.attr("name","qtiworks_response_"+m.responseIdentifier);b.attr("value",c);d.append(b)})}v.fn.orderInteraction=function(m){m=v.extend({responseIdentifier:null,formDispatchFieldId:null,minChoices:null,maxChoices:null,responseValue:null,opened:!1},
m);try{"undefined"!=typeof m.responseValue&&0<m.responseValue.length&&t(m),m.opened&&w(this,m)}catch(g){window.console&&console.log(g)}return this}})(jQuery);
(function(v){function w(m,g){var l=m.attr("id");m=jQuery("#"+l);var k=g.responseValue.split(":");l=jQuery("#"+l+" .items_container .o_item.o_"+g.responseIdentifier);for(var d=k.length;0<d--;){var a=k[d].split(" "),c=a[0];a=a[1];var b=jQuery(l.get(d));b.css("position","absolute");b.css("top",a+"px");b.css("left",c+"px");b="in-"+b.attr("id")+"-"+g.responseIdentifier;c=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("id",b).attr("name","qtiworks_response_"+g.responseIdentifier).attr("value",c+" "+a);
m.prepend(c)}}function t(m,g){var l=m.attr("id"),k=jQuery("#"+l);jQuery("#"+l+" .items_container .o_item.o_"+g.responseIdentifier).draggable({containment:"#"+l,scroll:!1,stop:function(d,a){a=jQuery("#"+l+"_img");d=jQuery(a).offset().top-jQuery(window).scrollTop();a=jQuery(a).offset().left-jQuery(window).scrollLeft();var c=jQuery(this).offset().top-jQuery(window).scrollTop(),b=jQuery(this).offset().left-jQuery(window).scrollLeft();a=Math.round(b-a);d=Math.round(c-d);c="in-"+jQuery(this).attr("id")+
"-"+g.responseIdentifier;b=k.find("#"+c);0==b.length?(d=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("id",c).attr("name","qtiworks_response_"+g.responseIdentifier).attr("value",a+" "+d),k.prepend(d)):b.val(a+" "+d);setFlexiFormDirty(g.formDispatchFieldId)}})}v.fn.positionObjectStage=function(m){m=v.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,maxChoices:1,opened:!1},m);try{var g=this.attr("id");jQuery("#"+g+" .items_container .o_item.o_"+m.responseIdentifier).each(function(l,
k){jQuery(k).attr("id","object-item-"+l)});"undefined"!==typeof m.responseValue&&0<m.responseValue.length&&w(this,m);m.opened&&t(this,m)}catch(l){window.console&&console.log(l)}return this}})(jQuery);
(function(v){function w(t,m){var g=t.attr("id");jQuery("#"+g+"_canvas").on("click",function(l,k){var d=jQuery(this).offset().top-jQuery(window).scrollTop();k=jQuery(this).offset().left-jQuery(window).scrollLeft();k=Math.round(l.clientX-k);var a=Math.round(l.clientY-d);l=jQuery("#"+g).data("openolat")||{};void 0==l.listOfPoints&&(l.listOfPoints=[],jQuery("#"+g).data("openolat",l));var c=!1,b=[];for(i=l.listOfPoints.length;0<i--;)d=l.listOfPoints[i],Math.pow(8,2)>(d.x-k)*(d.x-k)+(d.y-a)*(d.y-a)?c=!0:
b.push(d);if(c)l.listOfPoints=b;else{if(l.listOfPoints.length>=m.maxChoices)return!1;l.listOfPoints.push({x:k,y:a})}d=document.getElementById(g+"_canvas");k=d.getContext("2d");k.clearRect(0,0,jQuery(d).width(),jQuery(d).height());a=jQuery("#"+g);a.find("input[type\x3d'hidden']").remove();for(i=l.listOfPoints.length;0<i--;)d=l.listOfPoints[i],k.beginPath(),k.arc(d.x,d.y,8,0,2*Math.PI,!1),k.stroke(),k.closePath(),d=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+m.responseIdentifier).attr("value",
d.x+" "+d.y),a.append(d);setFlexiFormDirty(m.formDispatchFieldId)})}v.fn.selectPointInteraction=function(t){t=v.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,maxChoices:1,opened:!1},t);try{if("undefined"!==typeof t.responseValue&&0<t.responseValue.length){var m=this.attr("id"),g=jQuery("#"+m),l=t.responseValue.split(":"),k=document.getElementById(m+"_canvas"),d=k.getContext("2d");d.clearRect(0,0,jQuery(k).width(),jQuery(k).height());for(i=l.length;0<i--;)if(0!=l[i].length){var a=
l[i].split(" "),c=a[0],b=a[1];d.beginPath();d.arc(c,b,8,0,2*Math.PI,!1);d.stroke();d.closePath();var e=jQuery('\x3cinput type\x3d"hidden"/\x3e').attr("name","qtiworks_response_"+t.responseIdentifier).attr("value",c+" "+b);g.append(e)}}t.opened&&w(this,t)}catch(f){window.console&&console.log(f)}return this}})(jQuery);
(function(v){function w(t,m){var g=jQuery("#qtiworks_id_slider_"+m.responseIdentifier);t=jQuery('input[name\x3d"qtiworks_response_'+m.responseIdentifier+'"]').get(0).value||m.min;g.slider({value:t,step:m.step,disabled:!m.opened,orientation:m.orientation,min:m.isReversed?-m.max:m.min,max:m.isReversed?-m.min:m.max,slide:function(l,k){l=m.isReversed?-k.value:k.value;k=jQuery("#qtiworks_id_slidervalue_"+m.responseIdentifier);jQuery('input[name\x3d"qtiworks_response_'+m.responseIdentifier+'"]').get(0).value=
l;k.text(l);g.slider("value",m.isReversed?-l:l);setFlexiFormDirty(m.formDispatchFieldId)}})}v.fn.sliderInteraction=function(t){t=v.extend({responseIdentifier:null,formDispatchFieldId:null,responseValue:null,min:1,max:1,step:1,orientation:null,isReversed:!1,isDiscrete:!1,opened:!1,initialValue:null},t);try{w(this,t)}catch(m){window.console&&console.log(m)}return this}})(jQuery);
(function(v){v.fn.qtiCopyPaste=function(w){function t(k){k=k.replace(/\t/g,"");return k=k.replace(/(\r\n|\n|\r)/g,"")}var m=v.extend({errorHeader:null,errorMessage:null},w);w=function(){var k="",d=document.activeElement;"textarea"==(d?d.tagName.toLowerCase():null)&&"number"==typeof d.selectionStart?k=d.value.slice(d.selectionStart,d.selectionEnd):window.getSelection&&(k=document.getSelection().toString());g=k;return!0};var g="",l=document.getElementById(this.attr("id"));l.addEventListener("copy",
w,!1);l.addEventListener("cut",w,!1);l.addEventListener("paste",function(k){var d=k.clipboardData.getData("text");t(d)!==t(g)&&(k.preventDefault(),showMessageBox("warn",m.errorHeader,m.errorMessage));return!0});return this}})(jQuery);
(function(v){v.fn.qtiCountWord=function(w){var t=v.extend({responseUniqueId:null,labelSingular:"xxx word",labelPlural:"xxx words"},w),m=function(a,c){if(1==a.nodeType)if(("SPAN"===a.nodeName||"DIV"===a.nodeName)&&a.classList.contains("math"))c.formulas++;else{if(a.hasChildNodes()){a=a.childNodes;for(var b=a.length;0<b--;)m(a[b],c)}}else 3==a.nodeType&&(a=a.nodeValue.replace(/\u00a0/g," "),c.text+=" "+a)};this.countHtml=function(a){var c=document.createElement("div");c.innerHTML=a;a={text:"",formulas:0};
m(c,a);c=l(a.text);k(c+a.formulas)};var g=function(a){a=l(a);k(a)};this.countText=g;var l=function(a){a=a.match(/[\w\u00C0-\u00ff]+/g);var c=0;if(null!=a)for(var b=a.length;0<b--;)1<a[b].length&&c++;return c},k=function(a){var c=jQuery(d).parent().get(0),b=1<a?t.labelPlural:t.labelSingular;b=b.replace("xxx",""+a);jQuery(".o_qti_essay_num_of_words",c).text(b)},d="#oo_"+t.responseUniqueId;if(!jQuery(d).hasClass("o_richtext_mce"))jQuery("#oo_"+t.responseUniqueId).on("keyup",function(a){a=jQuery(d);g(a.val())});
return this}})(jQuery);
(function(v){v.fn.paintV2=function(t){var m=this.data("data-oo-paint-v2");"undefined"===typeof m&&(m=new w(this,t),this.data("data-oo-paint-v2",m));return m};var w=function(t,m){function g(){try{setFlexiFormDirty(q)}catch(p){window.console&&console.log(p)}}function l(p){k();jQuery(p).addClass("active")}function k(){jQuery("#"+r+" div.o_group_tools a").removeClass("active")}function d(){n.freeDrawingBrush.width=b();n.freeDrawingBrush.color=a()}function a(){var p=jQuery("#"+r+" div.o_group_colors a.active"),
u="rgba(0,0,0,1.0)";0<p.length&&(u=p[0].getAttribute("data-color"));p=parseInt(jQuery("#"+r+" div.opacity_range_ui").slider("value"));100>p&&(p/=100,u=u.substring(0,u.lastIndexOf(",")),u+=","+p+")");return u}function c(p){var u=p.lastIndexOf(","),A=p.substring(0,u);jQuery("#"+r+" div.o_group_colors a").each(function(D,E){(D=E.getAttribute("data-color"))&&0==D.indexOf(A)?jQuery(E).addClass("active"):jQuery(E).removeClass("active")});p=Math.round(100*parseFloat(p.substring(u+1,p.length-1)));0<=p&&100>=
p&&jQuery("#"+r+" div.opacity_range_ui").slider("value",p)}function b(){var p=jQuery("#"+r+" div.width_range_ui").slider("value");0==p&&(p=1);return p/2}function e(p){0<=p&&100>=p&&jQuery("#"+r+" div.width_range_ui").slider("value",2*p)}function f(){y.clearRect(0,0,x.width,x.height);var p=b()/2,u=a(),A=x.width/2,D=p+1;y.beginPath();y.arc(A,D,p,0,2*Math.PI,!1);y.fillStyle=u;y.fill();if(0==u.indexOf("rgba(255,255,255,")||0==u.indexOf("#ff0000"))y.strokeStyle="#000000",y.lineWidth="1",y.stroke()}this.settings=
v.extend({inputHolderId:"",formDispatchFieldId:""},m);const h=this.settings.inputHolderId,q=this.settings.formDispatchFieldId;var r="paintw_"+h,n=new fabric.Canvas("paint_"+h,{isDrawingMode:!1,preserveObjectStacking:!0});fabric.Object.prototype.erasable=!0;fabric.Object.prototype.transparentCorners=!1;fabric.Object.prototype.cornerColor="#2980b9";fabric.Object.prototype.borderColor="#2980b9";var x=document.querySelector("#"+r+" canvas.brush_size"),y=x.getContext("2d");(function(){jQuery("#"+r+" div.o_group_tools a[data-tool\x3dselect]").on("click",
function(){l(this);n.isDrawingMode=!1;B()});jQuery("#"+r+" div.o_group_tools a[data-tool\x3dfront]").on("click",function(){n.isDrawingMode=!1;var p=n.getActiveObject();null!=p&&(p.bringToFront(),n.renderAll());B();g()});jQuery("#"+r+" div.o_group_tools a[data-tool\x3dback]").on("click",function(){n.isDrawingMode=!1;var p=n.getActiveObject();null!=p&&(p.sendToBack(),n.renderAll());B();g()})})();(function(){jQuery("#"+r+" div.o_group_tools a[data-tool\x3dtext]").on("click",function(){n.isDrawingMode=
!1;k();var p=a(),u=b();p=new fabric.Textbox("Hello",{left:35,top:20,fill:p,fontFamily:"helvetica",fontSize:Math.floor(2.5*u),originX:"left",hasRotatingPoint:!1,centerTransform:!0,strokeUniform:!0});n.add(p);p.bringToFront();n.setActiveObject(p)});jQuery("#"+r+" div.o_group_tools a[data-tool\x3dcircle]").on("click",function(){n.isDrawingMode=!1;k();var p=a(),u=b();p=new fabric.Circle({left:45,top:25,radius:65,originX:"left",fill:"rgba(255,255,255,0.0)",strokeWidth:u,stroke:p,hasRotatingPoint:!1,centerTransform:!0,
strokeUniform:!0});p.setControlsVisibility({ml:!1,mb:!1,mr:!1,mt:!1,mtr:!1});n.add(p);p.bringToFront();n.setActiveObject(p)});jQuery("#"+r+" div.o_group_tools a[data-tool\x3drectangle]").on("click",function(){n.isDrawingMode=!1;k();var p=a(),u=b();p=new fabric.Rect({left:50,top:30,width:50,height:50,originX:"left",fill:"rgba(255,255,255,0.0)",strokeWidth:u,stroke:p,hasRotatingPoint:!1,centerTransform:!0,strokeUniform:!0});n.add(p);p.bringToFront();n.setActiveObject(p)});jQuery("#"+r+" div.o_group_tools a[data-tool\x3dellipse]").on("click",
function(){n.isDrawingMode=!1;k();var p=a(),u=b();p=new fabric.Ellipse({left:15,top:10,rx:65,ry:35,fill:"rgba(255,255,255,0.0)",strokeWidth:u,stroke:p,hasRotatingPoint:!1,centerTransform:!0,strokeUniform:!0});n.add(p);p.bringToFront();n.setActiveObject(p)})})();(function(){jQuery("#"+r+" div.o_group_tools a[data-tool\x3deraser]").on("click",function(){l(this);n.isDrawingMode=!0;n.freeDrawingBrush=new fabric.EraserBrush(n);n.freeDrawingBrush.width=b()});jQuery("#"+r+" div.o_group_tools a[data-tool\x3dbrush]").on("click",
function(){l(this);n.isDrawingMode=!0;n.freeDrawingBrush=new fabric.PencilBrush(n);d()}).each(function(p,u){l(this)});jQuery("#"+r+" div.o_group_tools a[data-tool\x3dspray]").on("click",function(){l(this);n.isDrawingMode=!0;n.freeDrawingBrush=new fabric.SprayBrush(n);d()})})();(function(){jQuery("#"+r+" div.o_group_tools a[data-tool\x3dline]").on("click",function(){n.isDrawingMode=!1;l(this)});var p,u=!1;n.on("mouse:down",function(A){var D=jQuery("#"+r+" div.o_group_tools a.active");D=null!=D&&0!=
D.length?D[0].getAttribute("data-tool"):null;if(n.isDrawingMode)d();else if("line"===D){u=!0;D=a();var E=b();A=n.getPointer(A.e);p=new fabric.Line([A.x,A.y,A.x,A.y],{stroke:D,strokeWidth:E,originX:"center",originY:"center"});n.add(p)}});n.on("mouse:move",function(A){u&&(A=n.getPointer(A.e),p.set({x2:A.x,y2:A.y}),n.renderAll())});n.on("mouse:up",function(A){u&&(u=!1,n.discardActiveObject().renderAll(),B())})})();(function(){jQuery("#"+r+" div.width_range_ui").slider({min:1,max:100,value:20,change:function(p,
u){p=u.value/2;n.freeDrawingBrush.width=p;n.freeDrawingBrush.color=a();f();u=n.getActiveObject();null!=u&&("circle"===u.type||"rect"===u.type||"ellipse"===u.type?(u.set("strokeWidth",p),n.renderAll()):"textbox"===u.type&&(u.set("fontSize",p),n.renderAll()),B(),g());d()}});jQuery("#"+r+" div.opacity_range_ui").slider({min:1,max:100,value:100,change:function(p,u){p=a();n.freeDrawingBrush.width=b();n.freeDrawingBrush.color=p;f();u=n.getActiveObject();null!=u&&("circle"===u.type||"rect"===u.type||"ellipse"===
u.type?(u.set("stroke",p),n.renderAll()):"textbox"===u.type&&(u.set("fill",p),n.renderAll()),B(),g());d()}})})();(function(){jQuery("#"+r+" div.o_group_colors a").on("click",function(){jQuery("#"+r+" div.o_group_colors a").removeClass("active");jQuery(this).addClass("active");var p=a();n.freeDrawingBrush.color=p;var u=n.getActiveObject();null!=u&&("circle"===u.type||"rect"===u.type||"ellipse"===u.type?(u.set("stroke",p),n.renderAll()):"textbox"===u.type&&(u.set("fill",p),n.renderAll()));B();f();g()})})();
(function(){jQuery("#"+r+" a.clear").on("click",function(){var p=n.getActiveObject();null!=p&&(n.remove(p),n.renderAll());B();g()});jQuery("#"+r+" a.clearall").on("click",function(){var p=o_getMainWin();var u=p?jQuery(document).ooTranslator().getTranslator(p.o_info.locale,"org.olat.ims.qti21.ui"):{translate:function(D){return D}};p=u.translate("cancel");var A=u.translate("paint.erase");u='\x3cdiv id\x3d"paintModal" class\x3d"modal fade" tabindex\x3d"-1" role\x3d"dialog"\x3e  \x3cdiv class\x3d"modal-dialog" role\x3d"document"\x3e    \x3cdiv class\x3d"modal-content"\x3e      \x3cdiv class\x3d"modal-body"\x3e        \x3cp\x3e'+
(u.translate("paint.erase.hint")+"\x3c/p\x3e      \x3c/div\x3e");u=u+'      \x3cdiv class\x3d"modal-footer"\x3e        \x3cbutton type\x3d"button" class\x3d"btn btn-default" data-dismiss\x3d"modal"\x3e'+(p+'\x3c/button\x3e        \x3cbutton type\x3d"button" class\x3d"btn btn-primary" data-dismiss\x3d"modal"\x3e')+(A+"\x3c/button\x3e");u+="      \x3c/div\x3e";u+="    \x3c/div\x3e";u+="  \x3c/div\x3e";u+="\x3c/div\x3e";jQuery("body").append(u);jQuery("#paintModal").modal("show");jQuery("#paintModal button.btn-primary").on("click",
function(){n.clear();try{n.getObjects();jQuery("#op_"+h+"_png").val("");var D=JSON.stringify(n);jQuery("#op_"+h+"_json").val("data:application/json;base64,"+D)}catch(E){window.console&&console.log(E)}g()});jQuery("#paintModal").on("hidden.bs.modal",function(D){jQuery("#paintModal").remove()});o_scrollTop()})})();var z=jQuery("#op_"+h+"_json").val();t="undefined"!=typeof z&&0<z.length;m=null;t&&(m=JSON.parse(z));try{var C=z&&null!=m&&m.objects&&0<m.objects.length}catch(p){window.console&&console.log(p),
C=!1}C?(l(jQuery("#"+r+" div.o_group_tools a[data-tool\x3dselect]")[0]),n.isDrawingMode=!1):(l(jQuery("#"+r+" div.o_group_tools a[data-tool\x3dbrush]")[0]),jQuery("#"+r+" div.o_group_colors a.blue").addClass("active"),n.isDrawingMode=!0,n.freeDrawingBrush.width=b(),n.freeDrawingBrush.color=a());f();C=function(p){p=p.target;if("textbox"===p.type)c(p.fill),e(p.fontSize);else if("circle"===p.type||"rect"===p.type||"ellipse"===p.type)c(p.stroke),e(p.strokeWidth)};n.on("selection:created",C);n.on("selection:updated",
C);var B=function(){try{n.getObjects();var p=n.toDataURL("png");jQuery("#op_"+h+"_png").val(p);var u=JSON.stringify(n);jQuery("#op_"+h+"_json").val("data:application/json;base64,"+u)}catch(A){window.console&&console.log(A)}};n.on("object:modified",B);n.on("object:added",B);n.on("object:removed",B);n.on("mouse:out",B);t&&n.loadFromJSON(m,function(){n.renderAll()},function(p,u){u.isType("circle")&&u.setControlsVisibility({ml:!1,mb:!1,mr:!1,mt:!1,mtr:!1})});n.on("object:modified",g);n.on("object:added",
g);n.on("object:removed",g)}})(jQuery);